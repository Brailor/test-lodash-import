# The effects of using `babel-plugin-lodash` in `instui`
This document will contain the results of testing the `babel-plugin-lodash` usage in `instui`.

## Testing methodology:
Create a template `React` application with `create-react-app` and add `@instructure/ui@8.30` as a dependency.
To create a baseline metric, run `npm run build` without changing anything in the source code, this yields an ouput of:

`main.js`: __46.61 kB__

`#.[hash].chunk.js`: __1.79 kB__

Then change the default source code - generated by `create-react-app` - in `src/App.js` to include `@instructure/ui` dependency by using the `View, InstuiSettingsProvider` components:

`main.js`: __kB__ (+kB)

`#.[hash].chunk.js`: __kB__


### Test the effect of adding `babel-plugin-lodash`
I released a version of `@instructure/ui` to a local npm registry, which uses `babel-plugin-lodash` to transform each import of `lodash` from named to default exports:
```js
import { map } from 'lodash'
```

To:
```js
import map from 'lodash/map'
```

Then I changed the dependency for `@instructure/ui` in the package.json in the consuming application from `"@instructure/ui": "8.30"` -> `"@instructure/ui": "8.30.1-snapshot-4441"`.

Then I run `npm run build` again with the same source code, which yielded the ouput of:

`main.js`: __kB__ (+kB)

`#.[hash].chunk.js`: __1.79 kB__


### Test the effect of adding `lodash` as a dependency to our consuming application
Next I added `lodash@4` to our app to see the effect of using `lodash` on the bundle size.

I made 3 testing scenarios:
- use `lodash` with only default imports (`import clone from "lodash/clone"`)
- use `lodash` with only named imports (`import { clone } from "lodash/clone"`)
- use mixed imports of `lodash`

The effects of these can be seen in the table below:

## Conclusion
Including this plugin makes sense when the consuming application of instui is either:
- does not use `lodash` as dependency
- only imports functions from `lodash` in the `import fn from "lodash/fn"` format (or it uses the plugin also to do this automatically)


Note:
    In the case where the consuming application does use `lodash` and it imports functions as named imports only, we can observe a slight increase (+5.31%) of bundle size when the `babel-plugin-lodash` is used in instui.

| Scenario | Main bundle size - without `babel-plugin-lodash` | Main bundle size - with `babel-plugin-lodash` | Delta |
| ------------- | ------------- | ------------- |------------- |
| Baseline (no instui dependency used) | 46.6 kB | 46.61 kB | +0.021% |
| No lodash extra dependency, only instui |  90.96 kB | 71.65 kB | -26.95% |
| Lodash with default import (`import clone from "lodash/clone"`) + instui |  94.01 kB | 71.69 kB | -31.13% |
| Lodash with named import (`import {clone} from "lodash"`) + instui |  90.09 kB | 95.14 kB | +5.31% |
| Mixed Lodash import + instui |  94.03 kB | 95.18 kB | +1.21% |
